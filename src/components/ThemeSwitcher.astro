---
/**
 * ThemeSwitcher.astro
 * Tailwind dark-mode toggle.
 * Uses <html class="dark"> for dark mode.
 * Stores preference in localStorage "fa-theme" as: 'light' | 'dark'
 */
---

<div class="flex items-center gap-2">
  <span
    id="faThemeLabel"
    class="hidden sm:inline text-xs text-slate-500 dark:text-white/60"
  >
    Day
  </span>

  <button
    id="faThemeToggle"
    type="button"
    class="relative inline-flex h-9 w-14 items-center rounded-full border border-slate-200 bg-slate-100 shadow-sm transition hover:bg-slate-200
           dark:border-white/10 dark:bg-white/10 dark:hover:bg-white/15"
    aria-label="Toggle theme"
    title="Toggle theme"
    aria-pressed="false"
  >
    <span class="pointer-events-none absolute left-2 text-[10px] text-slate-500 dark:text-white/60" aria-hidden="true">☀</span>
    <span class="pointer-events-none absolute right-2 text-[10px] text-slate-500 dark:text-white/60" aria-hidden="true">☾</span>

    <span
      id="faThemeKnob"
      class="inline-block h-7 w-7 translate-x-1 rounded-full bg-white shadow transition dark:translate-x-6"
      aria-hidden="true"
    ></span>
  </button>

  <script is:inline>
    (() => {
      const key = "fa-theme"; // 'light' | 'dark'
      const root = document.documentElement;

      const btn = document.getElementById("faThemeToggle");
      const label = document.getElementById("faThemeLabel");
      if (!btn) return;

      const normalize = (v) => (v === "dark" ? "dark" : "light");

      const getSaved = () => {
        try {
          return normalize(localStorage.getItem(key));
        } catch {
          return "light";
        }
      };

      const apply = (mode) => {
        const m = normalize(mode);
        const isDark = m === "dark";

        root.classList.toggle("dark", isDark);

        btn.setAttribute("data-mode", m);
        btn.setAttribute("aria-pressed", String(isDark));
        if (label) label.textContent = isDark ? "Night" : "Day";
      };

      const setSaved = (mode) => {
        const m = normalize(mode);
        try {
          localStorage.setItem(key, m);
        } catch {}
        apply(m);
      };

      // Init
      apply(getSaved());

      // Toggle
      btn.addEventListener("click", () => {
        const next = root.classList.contains("dark") ? "light" : "dark";
        setSaved(next);
      });

      // Sync across tabs
      window.addEventListener("storage", (e) => {
        if (e.key === key) apply(getSaved());
      });
    })();
  </script>
</div>
