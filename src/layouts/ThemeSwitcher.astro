<button
  id="themeBtn"
  class="rounded-xl border px-3 py-2 text-sm transition-smooth"
  style="border-color: var(--color-border); background: var(--color-surface); color: var(--color-text);"
  type="button"
  aria-label="Theme toggle"
>
  Theme: <span id="themeLabel">System</span>
</button>

<script is:inline>
  (() => {
    const key = "fa-theme";
    const root = document.documentElement;
    const btn = document.getElementById("themeBtn");
    const label = document.getElementById("themeLabel");

    const order = ["system", "dark", "light"];

    function getMode() {
      try {
        return localStorage.getItem(key) || "system";
      } catch {
        return "system";
      }
    }

    function apply(mode) {
      root.classList.remove("theme-light", "theme-dark");
      if (mode === "light") root.classList.add("theme-light");
      if (mode === "dark") root.classList.add("theme-dark");
      if (label) label.textContent = mode[0].toUpperCase() + mode.slice(1);
    }

    function cycle() {
      const cur = getMode();
      const next = order[(order.indexOf(cur) + 1) % order.length];
      try {
        localStorage.setItem(key, next);
      } catch {}
      apply(next);
    }

    apply(getMode());
    btn?.addEventListener("click", cycle);

    // If in system mode, respond to OS theme changes
    const mq = window.matchMedia("(prefers-color-scheme: dark)");
    mq.addEventListener?.("change", () => {
      if (getMode() === "system") apply("system");
    });
  })();
</script>
